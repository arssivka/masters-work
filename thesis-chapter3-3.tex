\section{Тестирование производительности}

В данном разделе приводятся результаты тестирования 
производительности межмодульной коммуникации разработанных 
библиотек. Так же приводится сравнение с аналогами из библиотеки 
boost. Тестирование производится на двух аппаратных платформах 
на базе следующих процессоров: Intel Atom z530 1.6ГГц и Intel 
Core i5-6300HQ 2.30ГГц. Данные результаты позволяют сравнить 
производительность как на мобильных системах, так и при 
использовании библиотеки на рабочих станциях, например, в 
качестве удаленного клиента. Тестирование происходит на 
операционной системе Arch Linux с ядром версии 4.10.13. Для 
замера производительности используется библиотека Celero, 
которая использует высокочастотные таймеры (1 МГц) для подсчета 
затраченного времени.

Далее приводятся результаты тестирования для системы рассылки сообщений. Поскольку система удаленных вызовов процедур работает аналогичным образом, то результаты производительности приблизительно равны.

Все тестовые сценарии работают по следующему алгоритму:

\begin{enumerate}
    \item Добавить \textit{N} слушателей/модулей в систему.
    \item Синхронизировать операции.
    \item Отправить \textit{M} сообщений.
    \item Синхронизировать операции.
\end{enumerate}

В каждом тесте суммарно передается $M \times N$ сообщений. 
Данные тесты позволяют проверить влияние на производительность 
как количества сообщений, так и количества модулей. Тесты 
рассылки сообщений исполняются в одном потоке т.к. в данном 
случае демонстрируется наибольшая потеря производительности. Так 
же в тестах с использованием библиотеки Boost отсутствует 
операция поиска нужного топика и слушатели добавляются сразу 
напрямую в требуемый объект, что существенно ускоряет добавление 
слушателей.

Сравнение производительности для Boost Asio производится только 
для пула задач, т.к. архитектура механизмов при использовании 
\textit{boost::asio::io\_service} в качестве лаунчера система 
механизмов остается неизменной.


\begin{table}[!htbp]
    \caption{\label{tab:atom_rrc_old}Синхронная рассылка сообщений (atom)}
    \begin{center}
        \begin{tabularx}{\textwidth}{|c|X|X|X|X|}
            \hline
            & \multicolumn{4}{|c|}{Количество сообщений} \\
            \hline
            Кол-во модулей & 100   & 1000   & 10000   & 100000   \\
            \hline
            10             & 0.598 мс  & 4.005 мс   & 52.678 мс   & 538.046 мс   \\
            \hline
            100            & 1.831 мс  & 14.785 мс  & 152.465 мс  & 1553.962 мс  \\
            \hline
            1000           & 14.13 мс & 148.920 мс & 1648.494 мс & 16764.12  мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}


\begin{table}[!htbp]
    \caption{\label{tab:atom_rrc}Асинхронная рассылка сообщений (atom)}
    \begin{center}
        \begin{tabularx}{\textwidth}{|c|X|X|X|X|}
            \hline
            & \multicolumn{4}{|c|}{Количество сообщений} \\
            \hline
            Кол-во модулей & 100   & 1000   & 10000   & 100000   \\
            \hline
            10             & 0.337 мс  & 3.295 мс   & 33.988 мс   & 339.594 мс   \\
            \hline
            100            & 0.845 мс  & 6.006 мс  & 58.637 мс  & 582.871 мс  \\
            \hline
            1000           & 7.508 мс & 46.813 мс & 444.112 мс & 4589.34  мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}


\begin{table}[!htbp]
    \caption{\label{tab:atom_signals2}Рассылка сообщений через Boost Signal2 (atom)}
    \begin{center}
        \begin{tabularx}{\textwidth}{|c|X|X|X|X|}
            \hline
            & \multicolumn{4}{|c|}{Количество сообщений} \\
            \hline
            Кол-во модулей & 100   & 1000   & 10000   & 100000   \\
            \hline
            10             & 0.698 мс  & 7.184 мс  & 72.441 мс & 729.576 мс   \\
            \hline
            100            & 3.392 мс  & 53.486 мс  & 515.957 мс  & 5898.091 мс  \\
            \hline
            1000           & 33.071 мс & 504.437 мс & 6142.687 мс & 65892.034 мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}


\begin{table}[!htbp]
    \caption{\label{tab:core_rrc_old}Синхронная рассылка сообщений (core i5)}
    \begin{center}
        \begin{tabularx}{\textwidth}{|c|X|X|X|X|}
            \hline
            & \multicolumn{4}{|c|}{Количество сообщений} \\
            \hline
            Кол-во модулей & 100   & 1000   & 10000   & 100000   \\
            \hline
            10             & 0.059 мс  & 0.456 мс   & 4.621 мс   & 49.460 мс   \\
            \hline
            100            & 0.28 мс  & 1.782 мс  & 21.069 мс  & 221.779 мс  \\
            \hline
            1000           & 3.296 мс & 27.85 мс & 275.936 мс & 2713.869 мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}

\begin{table}[!htbp]
    \caption{\label{tab:core_rrc}Асинхронная рассылка сообщений (core i5)}
    \begin{center}
        \begin{tabularx}{\textwidth}{|c|X|X|X|X|}
            \hline
            & \multicolumn{4}{|c|}{Количество сообщений} \\
            \hline
            Кол-во модулей & 100   & 1000   & 10000   & 100000   \\
            \hline
            10             & 0.047 мс  & 0.437 мс   & 4.176 мс   & 45.404 мс   \\
            \hline
            100            & 0.223 мс  & 1.644 мс  & 16.682 мс  & 170.504 мс  \\
            \hline
            1000           & 1.842 мс & 14.176 мс & 146.31 мс & 1461.084 мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}

\begin{table}[!htbp]
    \caption{\label{tab:core_signals2}Рассылка сообщений через Boost Signal2 (core i5)}
    \begin{center}
        \begin{tabularx}{\textwidth}{|c|X|X|X|X|}
            \hline
            & \multicolumn{4}{|c|}{Количество сообщений} \\
            \hline
            Кол-во модулей & 100   & 1000   & 10000   & 100000   \\
            \hline
            10             & 0.094 мс  & 0.777 мс   & 7.779 мс   
            & 80.16 мс   \\
            \hline
            100            & 0.578 мс  & 5.288 мс  & 56.391 мс  & 547.934 мс  \\
            \hline
            1000           & 5.964 мс & 56.390 мс & 570.35 мс & 5595.921 мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}

Результаты тестирования механизма рассылки сообщений 
представлены в таблицах \ref{tab:atom_rrc_old}, 
\ref{tab:atom_rrc}, \ref{tab:atom_signals2}, проведенных на 
Intel Atom, а в таблицах \ref{tab:core_rrc_old}, 
\ref{tab:core_rrc}, \ref{tab:core_signals2} - на Core i5. Из 
результатов видно, что количество затраченного времени 
возрастает линейно с увеличением количества сообщений и модулей. 
Результаты показывают средний прирост производительности в 
разработанных библиотеках приблихинельно в 5-8 раз в сравнении с 
реализацией на Boost Signal2.


На данный момент, средняя частота программного взаимодействия 
между операционной системой и аппаратным обеспечением мобильного 
работа находится на отметке примерно 14 миллисекунд. Это частота 
была получена на популярном мобильном роботе Darwoin OP 
\cite{ha2011development}. Наиболее вероятно, количество модулей 
и передаваемых сообщений в практическом использовании подобных 
робототехнических систем будет схоже с тем количеством, которое 
представлено в таблице 1 в первом тесте, то есть порядка 10 
модулей и 100 сообщений за одну итерацию. Предложенная 
робототехническая система справляется с такой нагрузкой меньше 
чем за десятые доли миллисекунды. Это значительно быстрее, чем 
скорость программного взаимодействия с аппаратным обеспечением 
робота. Самый худший случай нагрузки, представленный в тестах - 
это 1000 модулей и 100000 сообщений. По представленным 
результатам видно, что платформа справляется с такой нагрузкой 
за 1-2 секунды, в зависимости от реализации. В ситуациях 
реального времени, это неприемлемая скорость. Однако, сложно 
представить себе мобильного автономного робота, которому 
необходимо такое количество модулей и обрабатывающий такое 
количество данных. Как уже было сказано ранее, в наши дни, не 
существует такой автономной робототехнической системы.

\begin{table}[!htbp]
    \caption{\label{tab:atom_asio}Скорость добавления задач в 
    очередь (atom)}
    \begin{center}
        \begin{tabularx}{\linewidth}{|c|X|X|}
            \hline
            К-во потоков & RRC & Boost Asio  \\
            \hline
            1 & 2.197 мс & 3.19 мс \\
            \hline
            2 & 2.19 мс & 3.14 мс \\
            \hline
            4 & 2.263 мс & 3.16 мс \\
            \hline
            8 & 2.482 мс & 3.113 мс \\
            \hline
            16 & 2.35 мс & 3.118 мс \\
            \hline
            32 & 4.017 мс & 3.103 мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}

\begin{table}[!htbp]
    \caption{\label{tab:core_asio}Скорость добавления задач в 
    очередь (core i5)}
    \begin{center}
        \begin{tabularx}{\linewidth}{|c|X|X|}
            \hline
            К-во потоков & RRC & Boost Asio  \\
            \hline
            1 & 0.231 мс & 0.712 мс \\
            \hline
            2 & 0.167 мс & 1.468 мс \\
            \hline
            4 & 0.136 мс & 1.815 мс \\
            \hline
            8 & 0.113 мс & 1.952 мс \\
            \hline
            16 & 0.055 мс & 2.016 мс \\
            \hline
            32 & 0.029 мс & 2.119 мс \\
            \hline
        \end{tabularx}
    \end{center}
\end{table}

В таблицах \ref{tab:atom_asio}, \ref{tab:core_asio} приведены 
результаты тестов сравнения производительности очереди задач в 
RRC и Boost Asio. Для core i5 виден существенный прирост в 
производительности в разработанной библиотеке, особенно при 
увеличении количества потоков. Падение производительности при 
увеличении потоков у Asio, вероятнее всего, связанно с 
одновременным обращением к критической секции из разных потоков, 
работающих в разных ядрах процессов, из-за чего увеличивается 
количество системных вызовов. У Intel Atom не наблюдается 
существенных изменений производительности при увеличении 
количества потоков т.к. у процессора существует всего одно 
физическое ядро.